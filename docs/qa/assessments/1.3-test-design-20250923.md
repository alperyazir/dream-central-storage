# Test Design: Story 1.3

Date: 2025-09-23
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 6
- Unit tests: 2 (33%)
- Integration tests: 4 (67%)
- E2E tests: 0 (0%)
- Priority distribution: P0: 4, P1: 2, P2: 0, P3: 0

## Test Scenarios by Acceptance Criteria

### AC1: A `users` table is created in the database to store admin credentials securely (hashed passwords).

#### Scenarios

| ID            | Level       | Priority | Test                                                     | Justification                                                   |
| ------------- | ----------- | -------- | -------------------------------------------------------- | ---------------------------------------------------------------- |
| 1.3-UNIT-001  | Unit        | P0       | Validate PBKDF2 hashing/verification handles salts and rejects empty passwords | Pure security logic with no external dependencies; fail-fast guard on credential storage. |
| 1.3-INT-001   | Integration | P0       | Migration provisions `users` table with uniqueness + updated_at trigger | Ensures DB schema, constraints, and triggers behave correctly against a live engine. |

### AC2: An endpoint (`POST /auth/login`) accepts admin credentials.

#### Scenarios

| ID            | Level       | Priority | Test                                                     | Justification                                                   |
| ------------- | ----------- | -------- | -------------------------------------------------------- | ---------------------------------------------------------------- |
| 1.3-INT-002   | Integration | P0       | Login accepts valid credentials (normalized email) and reaches repository | Exercises FastAPI route, DB session, and hashing integration together. |
| 1.3-INT-003   | Integration | P0       | Login rejects invalid credentials with HTTP 401          | Critical negative case preventing unauthorized access across service boundaries. |

### AC3: Upon successful authentication, the endpoint returns a JWT access token.

#### Scenarios

| ID            | Level       | Priority | Test                                                     | Justification                                                   |
| ------------- | ----------- | -------- | -------------------------------------------------------- | ---------------------------------------------------------------- |
| 1.3-UNIT-002  | Unit        | P0       | JWT generator emits signed token with subject + exp claims | Cryptographic payload assembly is deterministic logic suited to unit validation; security-critical. |

### AC4: A command-line script securely adds the first admin user to the database.

#### Scenarios

| ID            | Level       | Priority | Test                                                     | Justification                                                   |
| ------------- | ----------- | -------- | -------------------------------------------------------- | ---------------------------------------------------------------- |
| 1.3-INT-004   | Integration | P1       | Bootstrap script hashes password and persists user       | Validates combined CLI + repository flow against the database. |
| 1.3-INT-005   | Integration | P1       | Bootstrap script prevents duplicate admin creation       | Ensures idempotency and clean error handling across persistence boundary. |

## Risk Coverage

- Security breach via weak credential handling → Covered by 1.3-UNIT-001, 1.3-UNIT-002, 1.3-INT-003.
- Data integrity issues in admin bootstrap → Covered by 1.3-INT-004, 1.3-INT-005.

## Recommended Execution Order

1. 1.3-UNIT-001 (password hashing)
2. 1.3-UNIT-002 (JWT generation)
3. 1.3-INT-001 (migration)
4. 1.3-INT-002 (login success)
5. 1.3-INT-003 (login failure)
6. 1.3-INT-004 and 1.3-INT-005 (bootstrap script)

## Coverage Checklist

- [x] Every AC has coverage
- [x] Test levels align with scope and dependencies
- [x] No duplicate coverage at same level
- [x] Priorities reflect security-critical nature of authentication
- [x] Test IDs follow `{EPIC}.{STORY}-{LEVEL}-{SEQ}` format
- [x] Scenarios are atomic and focused
