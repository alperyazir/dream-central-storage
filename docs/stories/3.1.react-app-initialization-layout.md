# Story 3.1: React App Initialization & Layout

## Status
Done

## Story
**As a** developer,
**I want** a new React application initialized within the monorepo with basic routing and a main application layout,
**so that** I have a foundation for building the Admin Panel UI.

## Acceptance Criteria
1. A new React application (using Vite + TypeScript) is created in the monorepo at `apps/admin-panel`.
2. A routing library (e.g., React Router) is set up with initial routes for Login and Dashboard pages.
3. A main layout component is created that includes a persistent navigation bar and a content area for pages to render in.
4. The React application is configured to communicate with the backend API using an environment variable for the API base URL.

## Tasks / Subtasks
- [x] Scaffold admin panel application (AC: 1) [Source: architecture/3-tech-stack.md#3-tech-stack]
  - [x] Use Vite + TypeScript template to create `apps/admin-panel` within the monorepo (AC: 1) [Source: architecture/12-unified-project-structure.md#12-unified-project-structure]
  - [x] Configure shared tooling (ESLint, Prettier, TS config) aligned with project standards (AC: 1) [Source: architecture/10-frontend-architecture.md#10-frontend-architecture]
- [x] Configure routing and base pages (AC: 2) [Source: architecture/10-frontend-architecture.md#10-frontend-architecture]
  - [x] Install and configure React Router with routes for `/login` and `/dashboard` (AC: 2) [Source: architecture/10-frontend-architecture.md#10-frontend-architecture]
  - [x] Provide placeholder components for Login and Dashboard pages to verify navigation (AC: 2) [Source: architecture/6-components.md#storage]
- [x] Implement main application layout shell (AC: 3) [Source: architecture/10-frontend-architecture.md#10-frontend-architecture]
  - [x] Create layout component with persistent navigation/sidebar and routed content area (AC: 3) [Source: architecture/6-components.md#storage]
  - [x] Ensure layout handles responsive breakpoints per UI goals (AC: 3) [Source: docs/prd/user-interface-design-goals.md]
- [x] API configuration & environment setup (AC: 4) [Source: architecture/3-tech-stack.md#3-tech-stack]
  - [x] Add environment variable support for API base URL and expose through a typed configuration module (AC: 4) [Source: architecture/10-frontend-architecture.md#10-frontend-architecture]
  - [x] Implement basic API client wrapper using fetch/axios with base URL (AC: 4) [Source: architecture/6-components.md#storage]
- [x] Testing & build verification (AC: 1, 2, 3, 4) [Source: architecture/16-testing-strategy.md#16-testing-strategy]
  - [x] Add initial Vitest/React Testing Library smoke tests for layout rendering and route switching (AC: 2, 3) [Source: architecture/16-testing-strategy.md#16-testing-strategy]
  - [x] Ensure `pnpm build` (or equivalent) runs without errors and integrate into CI (AC: 1, 4) [Source: architecture/3-tech-stack.md#3-tech-stack]

## Dev Notes
### Previous Story Insights
- Backend stories established JWT auth and storage APIs; future frontend stories will consume them, so ensure routing/layout anticipates protected routes. [Source: docs/stories/2.3.application-build-folder-upload-endpoint.md#dev-agent-record]

### Data Models
- No frontend data models yet; future stories will fetch book/app data from existing backend endpoints. [Source: architecture/5-api-specification.md#5-api-specification]

### API Specifications
- API base URL should be configurable to target different environments (local, staging). [Source: architecture/5-api-specification.md#5-api-specification]

### Component Specifications
- Layout and routing should follow the frontend architecture guidelines for component organization and Zustand-based state to come in Story 3.2+. [Source: architecture/10-frontend-architecture.md#10-frontend-architecture]

### File Locations
- Place new React app under `apps/admin-panel`, following monorepo conventions. [Source: architecture/12-unified-project-structure.md#12-unified-project-structure]

### Testing Requirements
- Adopt Vitest/RTL for component tests; set up basic smoke tests for layout and navigation. [Source: architecture/16-testing-strategy.md#16-testing-strategy]

### Technical Constraints
- Use React 18+, Vite, TypeScript per tech stack; ensure compatibility with existing pnpm workspace. [Source: architecture/3-tech-stack.md#3-tech-stack]

### Testing
- Integrate frontend tests/build into existing CI pipeline once scripts are defined. [Source: architecture/16-testing-strategy.md#16-testing-strategy]

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-09-23 | 0.1 | Initial draft created. | Bob (Scrum Master) |
| 2025-09-23 | 0.2 | Story validated and approved for development. | Sarah (Product Owner) |
| 2025-09-23 | 0.3 | Admin panel scaffolded with routing, layout, and tests; awaiting review. | James (Developer) |

## Dev Agent Record
### Agent Model Used
GPT-5 Codex (Developer Mode)

### Debug Log References
- `npm install` initially failed on ESLint 9 peer constraints; downgraded to ESLint 8 + `typescript-eslint@7` and reran successfully.
- Attempted `npm run lint -- --filter=admin-panel...`, `npm run test -- --filter=admin-panel...`, and `npm run build -- --filter=admin-panel...`; they run locally now that dependencies are installed.
- Attempted `npm run dev -- --filter=admin-panel...` and `npm run dev --workspace admin-panel -- --host 127.0.0.1`; Vite cannot bind to a port in the sandbox (`listen EPERM`).
- Swapped the build step to `tsc --noEmit`, reinstated Vitest globals, purged generated JS/d.ts artefacts, and reran `npm run lint -- --filter=admin-panel...`, `npm run build -- --filter=admin-panel...`, `npm run test -- --filter=admin-panel... -- --run` to confirm a clean tree.

### Completion Notes List
- Reworked routing to use a `MainLayout` outlet with persistent sidebar navigation and default redirects to the dashboard route.
- Added a typed environment configuration module, fetch-based API client helpers, and checked `.env.example`/`.gitignore` entries for the API base URL.
- Strengthened tooling via `typescript-eslint` ESLint config updates, Vitest type inclusion, and refreshed TypeScript project settings.
- Refined layout and navigation styling for responsive breakpoints and accessibility-minded semantics.
- Expanded Vitest + RTL smoke coverage with `MemoryRouter` to verify default dashboard render and navigation to the login page.
- Updated CI workflow to lint, test, and build the admin panel package within the existing pipeline.
- Hardened build/test tooling by preventing TypeScript emit in `apps/admin-panel/package.json`/`tsconfig.json`, restoring test type coverage, and cleaning prior artefacts.
- Wrapped navigation test interactions with `act`/async assertions to eliminate React warnings during Vitest runs.

### File List
- .github/workflows/ci.yml
- apps/admin-panel/.env.example
- apps/admin-panel/.gitignore
- apps/admin-panel/eslint.config.js
- apps/admin-panel/package.json
- apps/admin-panel/tsconfig.json
- apps/admin-panel/tsconfig.node.json
- apps/admin-panel/src/App.tsx
- apps/admin-panel/src/components/NavBar.tsx
- apps/admin-panel/src/config/environment.ts
- apps/admin-panel/src/layouts/MainLayout.tsx
- apps/admin-panel/src/lib/api.ts
- apps/admin-panel/src/styles/global.css
- apps/admin-panel/src/styles/layout.css
- apps/admin-panel/src/styles/navbar.css
- apps/admin-panel/src/__tests__/layout.test.tsx
- apps/admin-panel/src/vite-env.d.ts
- turbo.json
- package-lock.json

## QA Results
- **Gate:** PASS — Build/test now run clean with `tsc --noEmit` and Vitest globals; repo stays pristine and async routing test no longer emits warnings. React Router v7 future notices remain informational.
- **Finding 1:** RESOLVED — Build script performs type-check without emission (`apps/admin-panel/package.json:8`, `tsconfig.json:3-10`), and source tree remains free of generated JS/d.ts after `npm run build`.
- **Finding 2:** RESOLVED — Navigation test wraps the click in `act` and awaits `findByRole`, eliminating the previous warning (`apps/admin-panel/src/__tests__/layout.test.tsx:23-33`).
- **Finding 3:** RESOLVED — Tests participate in TS checking again via shared config (Vitest globals + `noEmit`), ensuring type safety for specs.
- **Tests Observed:** `npm run lint -- --filter=admin-panel...`, `npm run build -- --filter=admin-panel...`, `npm run test -- --filter=admin-panel... -- --run`.
