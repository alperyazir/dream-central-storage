# Story 5.5: Permanently Delete Trash Items

## Status
Approved

## Story
**As an** administrator,
**I want** the trash view to offer permanent deletion,
**so that** I can reclaim storage space when items are no longer needed.

## Acceptance Criteria
1. Trash entries gain a "Delete Permanently" action protected by a confirmation modal.
2. Confirming deletion removes the itemâ€™s folder from MinIO and deletes associated metadata records.
3. The trash view refreshes after deletion and surfaces success or error feedback to the user.
4. API requests are audited/logged to satisfy existing retention requirements.
5. Automated tests cover successful deletion, permission failures, and storage errors.

## Tasks / Subtasks
- [ ] Extend storage service with a hard-delete operation that removes folders from the trash bucket and purges database records (AC: 2, 4) [Source: docs/stories/4.2.restore-functionality-from-trash.md#dev-notes]
  - [ ] Ensure the operation respects retention policies and disallows deleting items newer than the required retention window unless overridden (AC: 4) [Source: docs/prd/requirements.md#non-functional]
- [ ] Add "Delete Permanently" controls to the trash UI, including confirmation modal and success/error toasts (AC: 1, 3) [Source: docs/stories/3.4.book-and-app-folder-upload-ui.md#dev-notes]
- [ ] Wire UI actions to the new API endpoint and refresh trash listings on completion (AC: 2, 3) [Source: docs/architecture/11-backend-architecture.md#11-backend-architecture]
- [ ] Implement audit logging for permanent deletions equivalent to other mutating operations (AC: 4) [Source: docs/prd/requirements.md#functional]
- [ ] Add automated test coverage: backend unit/integration tests for hard delete, frontend tests for UI controls and error handling (AC: 5) [Source: docs/architecture/16-testing-strategy.md#16-testing-strategy]
- [ ] Update operator documentation to describe the permanent deletion workflow and retention constraints (AC: 4) [Source: docs/prd/requirements.md#non-functional]

## Dev Notes
### Previous Story Insights
- Story 4.2 established the trash view and restore workflow; reuse its patterns for listing refresh and error handling. [Source: docs/stories/4.2.restore-functionality-from-trash.md#dev-notes]
- Story 4.1 introduced soft-delete semantics; confirm hard delete integrates cleanly with existing metadata states. [Source: docs/stories/4.1.soft-delete-for-books-and-apps.md#dev-notes]

### Data Models
- Ensure metadata schemas support a terminal state (e.g., removal) and that cascading deletes do not orphan related records. [Source: docs/architecture/9-database-schema.md#9-database-schema]

### API Specifications
- Add a `DELETE /trash/{item_id}` endpoint or equivalent to the API spec and document response codes for success vs conflicts. [Source: docs/architecture/5-api-specification.md#file-uploads]

### Component Specifications
- Confirmation modals should follow existing admin panel styling and accessibility patterns. [Source: docs/prd/user-interface-design-goals.md#key-interaction-paradigms]

### File Locations
- Backend changes: `apps/api/app/routers/trash.py`, services/helpers under `apps/api/app/services`. Frontend changes: `apps/admin-panel/src/features/trash`. [Source: docs/architecture/12-unified-project-structure.md#12-unified-project-structure]

### Testing Requirements
- End-to-end test scenario should validate that a permanently deleted item no longer appears in trash or main listings. [Source: docs/architecture/16-testing-strategy.md#16-testing-strategy]

### Technical Constraints
- Respect authentication and authorization; only privileged admins may invoke permanent deletion. [Source: docs/architecture/15-security-and-performance.md#security]

### Project Structure Notes
- Coordinate with backup automation to ensure hard deletes are captured in retention policies and documentation. [Source: docs/stories/4.3.implement-automated-storage-backups.md#dev-notes]

## Testing
- Backend: unit + integration coverage for hard delete operations.
- Frontend: UI interaction tests for confirmation modal and list refresh.
- Manual: verify retention rule enforcement in staging environment.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-10-04 | 0.1 | Initial draft created. | Sarah (Product Owner) |

## Dev Agent Record
### Agent Model Used
TBD

### Debug Log References
- N/A

### Completion Notes List
- N/A

### File List
- N/A

## QA Results
- Not yet reviewed.
